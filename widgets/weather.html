<!--
    ioBroker.vis weather Widget-Set


    Copyright 10.2015-2019 René G. <info@rg-engineering.eu>
-->
<!--
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.js"></script>
-->
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/lib/jquery.event.drag.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/lib/jquery.mousewheel.js"></script>

<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.canvaswrapper.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.colorhelpers.js"></script>


<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.saturated.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.browser.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.drawSeries.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.uiConstants.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.time.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.legend.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.navigate.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.touchNavigate.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.hover.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.touch.js"></script>
<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.selection.js"></script>

<script language="javascript" type="text/javascript" src="widgets/weather/lib/js/flot/jquery.flot.axislabels.js"></script>



<!-- doku for flot : -->
<!--  https://github.com/flot/flot/blob/master/API.md -->

<style>
    .chart-placeholder {
        width: 100%;
        height: 100%;
        font-size: 14px;
        line-height: 1.2em;
    }

    .legendLayer .background {
        fill: rgba(255, 255, 255, 0.85);
        stroke: rgba(0, 0, 0, 0.85);
        stroke-width: 1;
    }
</style>

<script type="text/javascript">
    'use strict';

    //require('flot');

    var MarkingColor = "eaebe5";

    if (vis.editMode) {
        // Add words for basic widgets
        $.extend(true, systemDictionary, {
            //            "format_date": { "en": "Dateformat", "de": "Datumformat", "ru": "?????? ????" },
            //            "format_date_tooltip": {"en": "Dateformat","de": "Datumformat","ru": "?????? ????"},

            "weather": {
                "en": "weather",
                "de": "Wetter",
                "ru": "Погода",
                "pt": "clima",
                "nl": "weer",
                "fr": "la météo",
                "it": "tempo metereologico",
                "es": "clima",
                "pl": "pogoda",
                "zh-cn": "天气"
            },
            "1 second": {
                "en": "1 second",
                "de": "1 Sekunde",
                "ru": "1 секунда",
                "pt": "1 segundo",
                "nl": "1 seconde",
                "fr": "1 seconde",
                "it": "1 secondo",
                "es": "1 segundo",
                "pl": "1 sekunda",
                "zh-cn": "1秒"
            },
            "10 seconds": {
                "en": "10 seconds",
                "de": "10 Sekunden",
                "ru": "10 секунд",
                "pt": "10 segundos",
                "nl": "10 seconden",
                "fr": "10 secondes",
                "it": "10 secondi",
                "es": "10 segundos",
                "pl": "10 sekund",
                "zh-cn": "10秒"
            },
            "30 seconds": {
                "en": "30 seconds",
                "de": "30 Sekunden",
                "ru": "30 секунд",
                "pt": "30 segundos",
                "nl": "30 seconden",
                "fr": "30 secondes",
                "it": "30 secondi",
                "es": "30 segundos",
                "pl": "30 sekund",
                "zh-cn": "30秒"
            },
            "1 minute": {
                "en": "1 minute",
                "de": "1 Minute",
                "ru": "1 минута",
                "pt": "1 minuto",
                "nl": "1 minuut",
                "fr": "1 minute",
                "it": "1 minuto",
                "es": "1 minuto",
                "pl": "1 minuta",
                "zh-cn": "1分钟"
            },
            "2 minutes": {
                "en": "2 minutes",
                "de": "2 Minuten",
                "ru": "2 минуты",
                "pt": "2 minutos",
                "nl": "2 minuten",
                "fr": "2 minutes",
                "it": "2 minuti",
                "es": "2 minutos",
                "pl": "2 minuty",
                "zh-cn": "2分钟"
            },
            "5 minutes": {
                "en": "5 minutes",
                "de": "5 Minuten",
                "ru": "5 минут",
                "pt": "5 minutos",
                "nl": "5 minuten",
                "fr": "5 minutes",
                "it": "5 minuti",
                "es": "5 minutos",
                "pl": "5 minut",
                "zh-cn": "5分钟"
            },
            "10 minutes": {
                "en": "10 minutes",
                "de": "10 Minuten",
                "ru": "10 минут",
                "pt": "10 minutos",
                "nl": "10 minuten",
                "fr": "10 minutes",
                "it": "10 minuti",
                "es": "10 minutos",
                "pl": "10 minut",
                "zh-cn": "10分钟"
            },
            "30 minutes": {
                "en": "30 minutes",
                "de": "30 Minuten",
                "ru": "30 минут",
                "pt": "30 minutos",
                "nl": "30 minuten",
                "fr": "30 minutes",
                "it": "30 minuti",
                "es": "30 minutos",
                "pl": "30 minut",
                "zh-cn": "30分钟"
            },
            "1 hour": {
                "en": "1 hour",
                "de": "1 Stunde",
                "ru": "1 час",
                "pt": "1 hora",
                "nl": "1 uur",
                "fr": "1 heure",
                "it": "1 ora",
                "es": "1 hora",
                "pl": "1 godzina",
                "zh-cn": "1小时"
            },
            "2 hours": {
                "en": "2 hours",
                "de": "2 Stunden",
                "ru": "два часа",
                "pt": "2 horas",
                "nl": "twee uur",
                "fr": "2 heures",
                "it": "2 ore",
                "es": "2 horas",
                "pl": "2 godziny",
                "zh-cn": "2小时"
            },
            "4 hours": {
                "en": "4 hours",
                "de": "4 Stunden",
                "ru": "4 часа",
                "pt": "4 horas",
                "nl": "4 uur",
                "fr": "4 heures",
                "it": "4 ore",
                "es": "4 horas",
                "pl": "4 godziny",
                "zh-cn": "4个小时"
            },
            "8 hours": {
                "en": "8 hours",
                "de": "8 Stunden",
                "ru": "8 часов",
                "pt": "8 horas",
                "nl": "8 uur",
                "fr": "8 heures",
                "it": "8 ore",
                "es": "8 horas",
                "pl": "8 godzin",
                "zh-cn": "8小时"
            },
            "12 hours": {
                "en": "12 hours",
                "de": "12 Stunden",
                "ru": "12 часов",
                "pt": "12 horas",
                "nl": "12 uren",
                "fr": "12 heures",
                "it": "12 ore",
                "es": "12 horas",
                "pl": "12 godzin",
                "zh-cn": "12小时"
            },
            "24 hours": {
                "en": "24 hours",
                "de": "24 Stunden",
                "ru": "24 часа",
                "pt": "24 horas",
                "nl": "24 uur",
                "fr": "24 heures",
                "it": "24 ore",
                "es": "24 horas",
                "pl": "24 godziny",
                "zh-cn": "24小时"
            },
            "instance": {
                "en": "weather instance",
                "de": "Wetterinstanz",
                "ru": "случай погоды",
                "pt": "instância climática",
                "nl": "weer exemplaar",
                "fr": "instance météo",
                "it": "istanza meteorologica",
                "es": "instancia meteorológica",
                "pl": "instancja pogodowa",
                "zh-cn": "天气实例"
            },
            "time_interval": {
                "en": "Time interval",
                "de": "Zeitintervall",
                "ru": "Интервал времени",
                "pt": "Intervalo de tempo",
                "nl": "Tijdsinterval",
                "fr": "Intervalle de temps",
                "it": "Intervallo di tempo",
                "es": "Intervalo de tiempo",
                "pl": "Przedział czasowy",
                "zh-cn": "时间间隔"
            },
            "group_oids": {
                "en": "OID's",
                "de": "OID's",
                "ru": "OID-х",
                "pt": "OID's",
                "nl": "OID's",
                "fr": "OID",
                "it": "di OID",
                "es": "OID",
                "pl": "OID",
                "zh-cn": "OID的"
            },
            "group_rain": {
                "en": "rain",
                "de": "Regen",
                "ru": "дождь",
                "pt": "chuva",
                "nl": "regen",
                "fr": "pluie",
                "it": "pioggia",
                "es": "lluvia",
                "pl": "deszcz",
                "zh-cn": "雨"
            },
            "group_chancerain": {
                "en": "chance of rain",
                "de": "Niederschlagswahrscheinlichkeit",
                "ru": "вероятность дождя",
                "pt": "chance de chover",
                "nl": "kans op regen",
                "fr": "risque de pluie",
                "it": "probabilità di pioggia",
                "es": "probabilidad de lluvia",
                "pl": "szansa na deszcz",
                "zh-cn": "下雨的机会"
            },
            "group_temperature": {
                "en": "temperature",
                "de": "Temperatur",
                "ru": "температура",
                "pt": "temperatura",
                "nl": "temperatuur",
                "fr": "Température",
                "it": "temperatura",
                "es": "temperatura",
                "pl": "temperatura",
                "zh-cn": "温度"
            },
            "group_clouds": {
                "en": "clouds",
                "de": "Wolken",
                "ru": "облака",
                "pt": "nuvens",
                "nl": "wolken",
                "fr": "des nuages",
                "it": "nuvole",
                "es": "nubes",
                "pl": "chmury",
                "zh-cn": "乌云"
            },
            "oid_value": {
                "en": "OID values",
                "de": "OID-Werte",
                "ru": "Значения OID",
                "pt": "Valores OID",
                "nl": "OID-waarden",
                "fr": "Valeurs OID",
                "it": "Valori OID",
                "es": "Valores OID",
                "pl": "Wartości OID",
                "zh-cn": "OID值"
            },
            "withxaxix": {
                "en": "show X axis",
                "de": "X-Achse anzeigen",
                "ru": "показать ось X",
                "pt": "mostre o eixo X",
                "nl": "X-as weergeven",
                "fr": "afficher l'axe X",
                "it": "mostra l'asse X.",
                "es": "mostrar eje X",
                "pl": "pokaż oś X.",
            },
            "rainvisible": {
                "en": "visible",
                "de": "sichtbar",
                "ru": "видимый",
                "pt": "visível",
                "nl": "zichtbaar",
                "fr": "visible",
                "it": "visibile",
                "es": "visible",
                "pl": "widoczny",
                "zh-cn": "可见"
            },
            "rainchartType": {
                "en": "chart type",
                "de": "Diagramm Typ",
                "ru": "тип диаграммы",
                "pt": "tipo de gráfico",
                "nl": "grafiektype",
                "fr": "type de graphique",
                "it": "tipo di grafico",
                "es": "tipo de gráfico",
                "pl": "typ wykresu",
                "zh-cn": "图表类型"
            },
            "raincolor": {
                "en": "color",
                "de": "Farbe",
                "ru": "цвет",
                "pt": "cor",
                "nl": "kleur",
                "fr": "Couleur",
                "it": "colore",
                "es": "color",
                "pl": "kolor",
                "zh-cn": "颜色"
            },
            "chancerainvisible": {
                "en": "visible",
                "de": "sichtbar",
                "ru": "видимый",
                "pt": "visível",
                "nl": "zichtbaar",
                "fr": "visible",
                "it": "visibile",
                "es": "visible",
                "pl": "widoczny",
                "zh-cn": "可见"
            },
            "tempvisible": {
                "en": "visible",
                "de": "sichtbar",
                "ru": "видимый",
                "pt": "visível",
                "nl": "zichtbaar",
                "fr": "visible",
                "it": "visibile",
                "es": "visible",
                "pl": "widoczny",
                "zh-cn": "可见"
            },
            "tempchartType": {
                "en": "chart type",
                "de": "Diagramm Typ",
                "ru": "тип диаграммы",
                "pt": "tipo de gráfico",
                "nl": "grafiektype",
                "fr": "type de graphique",
                "it": "tipo di grafico",
                "es": "tipo de gráfico",
                "pl": "typ wykresu",
                "zh-cn": "图表类型"
            },
            "tempcolor": {
                "en": "color",
                "de": "Farbe",
                "ru": "цвет",
                "pt": "cor",
                "nl": "kleur",
                "fr": "Couleur",
                "it": "colore",
                "es": "color",
                "pl": "kolor",
                "zh-cn": "颜色"
            },
            "chanceraincolor": {
                "en": "color",
                "de": "Farbe",
                "ru": "цвет",
                "pt": "cor",
                "nl": "kleur",
                "fr": "Couleur",
                "it": "colore",
                "es": "color",
                "pl": "kolor",
                "zh-cn": "颜色"
            },
            "cloudsvisible": {
                "en": "visible",
                "de": "sichtbar",
                "ru": "видимый",
                "pt": "visível",
                "nl": "zichtbaar",
                "fr": "visible",
                "it": "visibile",
                "es": "visible",
                "pl": "widoczny",
                "zh-cn": "可见"
            },
            "cloudschartType": {
                "en": "chart type",
                "de": "Diagramm Typ",
                "ru": "тип диаграммы",
                "pt": "tipo de gráfico",
                "nl": "grafiektype",
                "fr": "type de graphique",
                "it": "tipo di grafico",
                "es": "tipo de gráfico",
                "pl": "typ wykresu",
                "zh-cn": "图表类型"
            },
            "sunorcloud": {
                "en": "show sun or clouds",
                "de": "Sonne oder Wolken zeigen",
                "ru": "показать солнце или облака",
                "pt": "mostre sol ou nuvens",
                "nl": "toon zon of wolken",
                "fr": "montrer du soleil ou des nuages",
                "it": "mostra sole o nuvole",
                "es": "mostrar sol o nubes",
                "pl": "pokaż słońce lub chmury",
                "zh-cn": "显示太阳或云"
            },
            "cloudcolor": {
                "en": "color",
                "de": "Farbe",
                "ru": "цвет",
                "pt": "cor",
                "nl": "kleur",
                "fr": "Couleur",
                "it": "colore",
                "es": "color",
                "pl": "kolor",
                "zh-cn": "颜色"
            },
            "line": {
                "en": "line",
                "de": "Linie",
                "ru": "линия",
                "pt": "linha",
                "nl": "lijn",
                "fr": "ligne",
                "it": "linea",
                "es": "línea",
                "pl": "linia",
                "zh-cn": "线"
            },
            "bar": {
                "en": "bar",
                "de": "Balken",
                "ru": "бар",
                "pt": "Barra",
                "nl": "bar",
                "fr": "bar",
                "it": "bar",
                "es": "bar",
                "pl": "bar",
                "zh-cn": "酒吧"
            },
            "sun": {
                "en": "sun",
                "de": "Sonne",
                "ru": "солнце",
                "pt": "Dom",
                "nl": "zon",
                "fr": "Soleil",
                "it": "sole",
                "es": "Dom",
                "pl": "słońce",
                "zh-cn": "太阳"
            },
            "clouds": {
                "en": "clouds",
                "de": "Wolken",
                "ru": "облака",
                "pt": "nuvens",
                "nl": "wolken",
                "fr": "des nuages",
                "it": "nuvole",
                "es": "nubes",
                "pl": "chmury",
                "zh-cn": "乌云"
            },
            "axislabelcolor": {
                "en": "color of axis label",
                "de": "Farbe der Achsenbeschriftung",
                "ru": "цвет метки оси",
                "pt": "cor do rótulo do eixo",
                "nl": "kleur van aslabel",
                "fr": "couleur de l'étiquette de l'axe",
                "it": "colore dell'etichetta dell'asse",
                "es": "color de la etiqueta del eje",
                "pl": "kolor etykiety osi",
                "zh-cn": "轴标颜色"
            },
            "tickscolor": {
                "en": "color of axis ticks",
                "de": "Farbe der Achsenstriche",
                "ru": "цвет отметок оси",
                "pt": "cor dos tiques do eixo",
                "nl": "kleur van as tikken",
                "fr": "couleur des tiques des axes",
                "it": "colore delle zecche degli assi",
                "es": "color de las garrapatas del eje",
                "pl": "kolor znaczników osi",
                "zh-cn": "轴刻度的颜色"
            },
            "markingcolor": {
                "en": "color of marking",
                "de": "Farbe der Markierung",
                "ru": "цвет маркировки",
                "pt": "cor da marcação",
                "nl": "kleur van markering",
                "fr": "couleur de marquage",
                "it": "colore della marcatura",
                "es": "color de marcado",
                "pl": "kolor oznakowania",
                "zh-cn": "标记颜色"
            },
            "withmarking": {
                "en": "with marking",
                "de": "mit Markierung",
                "ru": "с маркировкой",
                "pt": "com marcação",
                "nl": "met markering",
                "fr": "avec marquage",
                "it": "con marcatura",
                "es": "con marcado",
                "pl": "z oznaczeniem",
                "zh-cn": "带标记"
            },
            "maxY_temp": {
                "en": "max. value y-axix (0 for auto)",
                "de": "max. Wert y-Achse (0 für Auto)",
                "ru": "Максимум. значение оси Y (0 для авто)",
                "pt": "máx. valor y-axix (0 para automático)",
                "nl": "max. waarde y-axix (0 voor auto)",
                "fr": "max. valeur y-axix (0 pour auto)",
                "it": "max. valore y-axix (0 per auto)",
                "es": "max. valor y-axix (0 para auto)",
                "pl": "max. wartość y-axix (0 dla auto)",
                "zh-cn": "最高值y轴（自动为0）"
            },
            "minY_temp": {
                "en": "min. value y-axix (0 for auto)",
                "de": "min. Wert y-Achse (0 für Auto)",
                "ru": "минимум значение оси Y (0 для авто)",
                "pt": "min. valor y-axix (0 para automático)",
                "nl": "min. waarde y-axix (0 voor auto)",
                "fr": "min. valeur y-axix (0 pour auto)",
                "it": "min. valore y-axix (0 per auto)",
                "es": "min. valor y-axix (0 para auto)",
                "pl": "min. wartość y-axix (0 dla auto)",
                "zh-cn": "分钟值y轴（自动为0）"
            },
            "yTempVisible": {
                "en": "show y axis",
                "de": "y-Achse anzeigen",
                "ru": "показать ось у",
                "pt": "mostre o eixo y",
                "nl": "y-as weergeven",
                "fr": "afficher l'axe y",
                "it": "mostra l'asse y",
                "es": "mostrar eje y",
                "pl": "pokaż oś y",
                "zh-cn": "显示y轴"
            },
            "yRainVisible": {
                "en": "show y axis",
                "de": "y-Achse anzeigen",
                "ru": "показать ось у",
                "pt": "mostre o eixo y",
                "nl": "y-as weergeven",
                "fr": "afficher l'axe y",
                "it": "mostra l'asse y",
                "es": "mostrar eje y",
                "pl": "pokaż oś y",
                "zh-cn": "显示y轴"
            },
            "yCloudVisible": {
                "en": "show y axis",
                "de": "y-Achse anzeigen",
                "ru": "показать ось у",
                "pt": "mostre o eixo y",
                "nl": "y-as weergeven",
                "fr": "afficher l'axe y",
                "it": "mostra l'asse y",
                "es": "mostrar eje y",
                "pl": "pokaż oś y",
                "zh-cn": "显示y轴"
            },
            "yChanceRainVisible": {
                "en": "show y axis",
                "de": "y-Achse anzeigen",
                "ru": "показать ось у",
                "pt": "mostre o eixo y",
                "nl": "y-as weergeven",
                "fr": "afficher l'axe y",
                "it": "mostra l'asse y",
                "es": "mostrar eje y",
                "pl": "pokaż oś y",
                "zh-cn": "显示y轴"
            },
            "xDateFormat": {
                "en": "format for date/time on x-axis",
                "de": "Format für Datum / Uhrzeit auf der x-Achse",
                "ru": "формат даты / времени по оси X",
                "pt": "formato para data / hora no eixo x",
                "nl": "formaat voor datum / tijd op x-as",
                "fr": "format de date / heure sur l'axe des x",
                "it": "formato per data / ora sull'asse x",
                "es": "formato para fecha / hora en eje x",
                "pl": "format daty / godziny na osi x",
                "zh-cn": "x轴上日期/时间的格式"
            },
            "nobgcolor": {
                "en": "no background color on grid",
                "de": "Keine Hintergrundfarbe im Raster",
                "ru": "нет цвета фона на сетке",
                "pt": "sem cor de fundo na grade",
                "nl": "geen achtergrondkleur op het raster",
                "fr": "pas de couleur d'arrière-plan sur la grille",
                "it": "nessun colore di sfondo sulla griglia",
                "es": "sin color de fondo en la cuadrícula",
                "pl": "brak koloru tła na siatce",
                "zh-cn": "网格上没有背景色"
            },

            "bgcolor": {
                "en": "background color on grid",
                "de": "Hintergrundfarbe auf Raster",
                "ru": "цвет фона на сетке",
                "pt": "cor de fundo na grade",
                "nl": "achtergrondkleur op het raster",
                "fr": "couleur de fond sur la grille",
                "it": "colore di sfondo sulla griglia",
                "es": "color de fondo en la cuadrícula",
                "pl": "kolor tła na siatce",
                "zh-cn": "网格上的背景色"
            },
            /*
            "withborder": {
                "en": "show border of grid",
                "de": "Rahmen des Gitters anzeigen",
                "ru": "показать границу сетки",
                "pt": "mostrar borda da grade",
                "nl": "rand van raster weergeven",
                "fr": "montrer la bordure de la grille",
                "it": "mostra il bordo della griglia",
                "es": "mostrar borde de cuadrícula",
                "pl": "pokaż granicę siatki",
                "zh-cn": "显示网格边框"
            },*/
            "bordercolor": {
                "en": "color of grid border",
                "de": "Farbe des Gitterrandes",
                "ru": "цвет границы сетки",
                "pt": "cor da borda da grade",
                "nl": "kleur van de rasterrand",
                "fr": "couleur de la bordure de la grille",
                "it": "colore del bordo della griglia",
                "es": "color del borde de la cuadrícula",
                "pl": "kolor obramowania siatki",
                "zh-cn": "网格边框的颜色"
            },
            "borderWidth": {
                "en": "width of grid border",
                "de": "Breite des Gitterrandes",
                "ru": "ширина границы сетки",
                "pt": "largura da borda da grade",
                "nl": "breedte van de rasterrand",
                "fr": "largeur de la bordure de la grille",
                "it": "larghezza del bordo della griglia",
                "es": "ancho del borde de la cuadrícula",
                "pl": "szerokość granicy siatki",
                "zh-cn": "网格边框的宽度"
            },
            "datastructure": {
                "en": "data structure",
                "de": "Datenstruktur",
                "ru": "структура данных",
                "pt": "estrutura de dados",
                "nl": "data structuur",
                "fr": "Structure de données",
                "it": "struttura dati",
                "es": "estructura de datos",
                "pl": "struktura danych",
                "zh-cn": "数据结构"
            },
            "raincolorticklabel": {
                "en": "color tick label",
                "de": "Farbe Tick Label",
                "ru": "цветная метка",
                "pt": "etiqueta de escala de cores",
                "nl": "kleur maatlabel",
                "fr": "étiquette de couleur tique",
                "it": "etichetta con segno di spunta di colore",
                "es": "etiqueta de marca de color",
                "pl": "kolorowa etykieta kleszczowa",
                "zh-cn": "彩色刻度标签"
            },
            "chanceraincolorticklabel": {
                "en": "color tick label",
                "de": "Farbe Tick Label",
                "ru": "цветная метка",
                "pt": "etiqueta de escala de cores",
                "nl": "kleur maatlabel",
                "fr": "étiquette de couleur tique",
                "it": "etichetta con segno di spunta di colore",
                "es": "etiqueta de marca de color",
                "pl": "kolorowa etykieta kleszczowa",
                "zh-cn": "彩色刻度标签"
            },
            "tempcolorticklabel": {
                "en": "color tick label",
                "de": "Farbe Tick Label",
                "ru": "цветная метка",
                "pt": "etiqueta de escala de cores",
                "nl": "kleur maatlabel",
                "fr": "étiquette de couleur tique",
                "it": "etichetta con segno di spunta di colore",
                "es": "etiqueta de marca de color",
                "pl": "kolorowa etykieta kleszczowa",
                "zh-cn": "彩色刻度标签"
            },
            "cloudcolorticklabel": {
                "en": "color tick label",
                "de": "Farbe Tick Label",
                "ru": "цветная метка",
                "pt": "etiqueta de escala de cores",
                "nl": "kleur maatlabel",
                "fr": "étiquette de couleur tique",
                "it": "etichetta con segno di spunta di colore",
                "es": "etiqueta de marca de color",
                "pl": "kolorowa etykieta kleszczowa",
                "zh-cn": "彩色刻度标签"
            },

            "raincoloraxis": {
                "en": "color of axis",
                "de": "Farbe der Achse",
                "ru": "цвет оси",
                "pt": "cor do eixo",
                "nl": "kleur van de as",
                "fr": "couleur de l'axe",
                "it": "colore dell'asse",
                "es": "color del eje",
                "pl": "kolor osi",
                "zh-cn": "轴的颜色"
            },
            "chanceraincoloraxis": {
                "en": "color of axis",
                "de": "Farbe der Achse",
                "ru": "цвет оси",
                "pt": "cor do eixo",
                "nl": "kleur van de as",
                "fr": "couleur de l'axe",
                "it": "colore dell'asse",
                "es": "color del eje",
                "pl": "kolor osi",
                "zh-cn": "轴的颜色"
            },
            "tempcoloraxis": {
                "en": "color of axis",
                "de": "Farbe der Achse",
                "ru": "цвет оси",
                "pt": "cor do eixo",
                "nl": "kleur van de as",
                "fr": "couleur de l'axe",
                "it": "colore dell'asse",
                "es": "color del eje",
                "pl": "kolor osi",
                "zh-cn": "轴的颜色"
            },
            "cloudcoloraxis": {
                "en": "color of axis",
                "de": "Farbe der Achse",
                "ru": "цвет оси",
                "pt": "cor do eixo",
                "nl": "kleur van de as",
                "fr": "couleur de l'axe",
                "it": "colore dell'asse",
                "es": "color del eje",
                "pl": "kolor osi",
                "zh-cn": "轴的颜色"
            },
            "LabelFontSize": {
                "en": "size of Label Font",
                "de": "Größe der Beschriftungsschrift",
                "ru": "размер шрифта метки",
                "pt": "tamanho da fonte da etiqueta",
                "nl": "grootte van het lettertype",
                "fr": "taille de la police d'étiquette",
                "it": "dimensione del carattere dell'etichetta",
                "es": "tamaño de la fuente de la etiqueta",
                "pl": "rozmiar czcionki etykiety",
                "zh-cn": "标签字体的大小"
            },
            "LabelFontFamily": {
                "en": "family of label font",
                "de": "Schriftfamilie",
                "ru": "семейство меток шрифта",
                "pt": "família de fontes de rótulo",
                "nl": "familie van lettertype",
                "fr": "famille de polices d'étiquettes",
                "it": "famiglia di caratteri etichetta",
                "es": "familia de fuente de etiquetas",
                "pl": "rodzina czcionek etykiet",
                "zh-cn": "标签字体家族"
            },


            "rainname": {
                "en": "name on legend",
                "de": "Name auf Legende",
                "ru": "имя по легенде",
                "pt": "nome na legenda",
                "nl": "naam op legende",
                "fr": "nom sur la légende",
                "it": "nome sulla leggenda",
                "es": "nombre en la leyenda",
                "pl": "imię na legendzie",
                "zh-cn": "传说中的名字"
            },
            "tempname": {
                "en": "name on legend",
                "de": "Name auf Legende",
                "ru": "имя по легенде",
                "pt": "nome na legenda",
                "nl": "naam op legende",
                "fr": "nom sur la légende",
                "it": "nome sulla leggenda",
                "es": "nombre en la leyenda",
                "pl": "imię na legendzie",
                "zh-cn": "传说中的名字"
            },
            "cloudsname": {
                "en": "name on legend",
                "de": "Name auf Legende",
                "ru": "имя по легенде",
                "pt": "nome na legenda",
                "nl": "naam op legende",
                "fr": "nom sur la légende",
                "it": "nome sulla leggenda",
                "es": "nombre en la leyenda",
                "pl": "imię na legendzie",
                "zh-cn": "传说中的名字"
            },
            "chancerainname": {
                "en": "name on legend",
                "de": "Name auf Legende",
                "ru": "имя по легенде",
                "pt": "nome na legenda",
                "nl": "naam op legende",
                "fr": "nom sur la légende",
                "it": "nome sulla leggenda",
                "es": "nombre en la leyenda",
                "pl": "imię na legendzie",
                "zh-cn": "传说中的名字"
            },

            "raintickLength": {
                "en": "length of tick",
                "de": "Länge des Ticks",
                "ru": "длина тика",
                "pt": "comprimento do carrapato",
                "nl": "lengte van de teek",
                "fr": "longueur de tique",
                "it": "lunghezza del segno di spunta",
                "es": "longitud de la garrapata",
                "pl": "długość kleszcza",
                "zh-cn": "tick的长度"
            },
            "rainshowMinorTicks": {
                "en": "show minor tick",
                "de": "zeige kleine Ticks",
                "ru": "показать небольшую галочку",
                "pt": "mostre carrapato menor",
                "nl": "toon kleine vinkjes",
                "fr": "montrer une tique mineure",
                "it": "mostra segno di spunta minore",
                "es": "mostrar marca menor",
                "pl": "pokaż drobne kleszcze",
                "zh-cn": "显示小勾"
            },
            "rainshowTicks": {
                "en": "show tick",
                "de": "zeige ticks",
                "ru": "показать галочку",
                "pt": "show tick",
                "nl": "vinkje tonen",
                "fr": "montrer tique",
                "it": "mostra tick",
                "es": "mostrar marca",
                "pl": "pokaż tik",
                "zh-cn": "显示刻度"
            },
            "raintickDecimals": {
                "en": "decimals",
                "de": "Dezimalstellen",
                "ru": "десятичные",
                "pt": "decimais",
                "nl": "decimalen",
                "fr": "décimales",
                "it": "decimali",
                "es": "decimales",
                "pl": "miejsca po przecinku",
                "zh-cn": "小数点"
            },
            "raintickSize": {
                "en": "tick size",
                "de": "Tick-Größe",
                "ru": "размер галочки",
                "pt": "tamanho do carrapato",
                "nl": "teken grootte",
                "fr": "taille de la tique",
                "it": "dimensione tick",
                "es": "tamaño de la garrapata",
                "pl": "rozmiar kleszcza",
                "zh-cn": "刻度大小"
            },
            "rainminTickSize": {
                "en": "min. tick size",
                "de": "Mindest. Tick-Größe",
                "ru": "минимум размер галочки",
                "pt": "min. tamanho do carrapato",
                "nl": "min. teken grootte",
                "fr": "min. taille de la tique",
                "it": "min. dimensione tick",
                "es": "min. tamaño de la garrapata",
                "pl": "min. rozmiar kleszcza",
                "zh-cn": "分钟刻度大小"
            },

            "chanceraintickLength": {
                "en": "length of tick",
                "de": "Länge des Ticks",
                "ru": "длина тика",
                "pt": "comprimento do carrapato",
                "nl": "lengte van de teek",
                "fr": "longueur de tique",
                "it": "lunghezza del segno di spunta",
                "es": "longitud de la garrapata",
                "pl": "długość kleszcza",
                "zh-cn": "tick的长度"
            },
            "chancerainshowMinorTicks": {
                "en": "show minor tick",
                "de": "zeige kleine Ticks",
                "ru": "показать небольшую галочку",
                "pt": "mostre carrapato menor",
                "nl": "toon kleine vinkjes",
                "fr": "montrer une tique mineure",
                "it": "mostra segno di spunta minore",
                "es": "mostrar marca menor",
                "pl": "pokaż drobne kleszcze",
                "zh-cn": "显示小勾"
            },
            "chancerainshowTicks": {
                "en": "show tick",
                "de": "zeige ticks",
                "ru": "показать галочку",
                "pt": "show tick",
                "nl": "vinkje tonen",
                "fr": "montrer tique",
                "it": "mostra tick",
                "es": "mostrar marca",
                "pl": "pokaż tik",
                "zh-cn": "显示刻度"
            },
            "chanceraintickDecimals": {
                "en": "decimals",
                "de": "Dezimalstellen",
                "ru": "десятичные",
                "pt": "decimais",
                "nl": "decimalen",
                "fr": "décimales",
                "it": "decimali",
                "es": "decimales",
                "pl": "miejsca po przecinku",
                "zh-cn": "小数点"
            },
            "chanceraintickSize": {
                "en": "tick size",
                "de": "Tick-Größe",
                "ru": "размер галочки",
                "pt": "tamanho do carrapato",
                "nl": "teken grootte",
                "fr": "taille de la tique",
                "it": "dimensione tick",
                "es": "tamaño de la garrapata",
                "pl": "rozmiar kleszcza",
                "zh-cn": "刻度大小"
            },
            "chancerainminTickSize": {
                "en": "min. tick size",
                "de": "Mindest. Tick-Größe",
                "ru": "минимум размер галочки",
                "pt": "min. tamanho do carrapato",
                "nl": "min. teken grootte",
                "fr": "min. taille de la tique",
                "it": "min. dimensione tick",
                "es": "min. tamaño de la garrapata",
                "pl": "min. rozmiar kleszcza",
                "zh-cn": "分钟刻度大小"
            },

            "temptickLength": {
                "en": "length of tick",
                "de": "Länge des Ticks",
                "ru": "длина тика",
                "pt": "comprimento do carrapato",
                "nl": "lengte van de teek",
                "fr": "longueur de tique",
                "it": "lunghezza del segno di spunta",
                "es": "longitud de la garrapata",
                "pl": "długość kleszcza",
                "zh-cn": "tick的长度"
            },
            "tempshowMinorTicks": {
                "en": "show minor tick",
                "de": "zeige kleine Ticks",
                "ru": "показать небольшую галочку",
                "pt": "mostre carrapato menor",
                "nl": "toon kleine vinkjes",
                "fr": "montrer une tique mineure",
                "it": "mostra segno di spunta minore",
                "es": "mostrar marca menor",
                "pl": "pokaż drobne kleszcze",
                "zh-cn": "显示小勾"
            },
            "tempshowTicks": {
                "en": "show tick",
                "de": "zeige ticks",
                "ru": "показать галочку",
                "pt": "show tick",
                "nl": "vinkje tonen",
                "fr": "montrer tique",
                "it": "mostra tick",
                "es": "mostrar marca",
                "pl": "pokaż tik",
                "zh-cn": "显示刻度"
            },
            "temptickDecimals": {
                "en": "decimals",
                "de": "Dezimalstellen",
                "ru": "десятичные",
                "pt": "decimais",
                "nl": "decimalen",
                "fr": "décimales",
                "it": "decimali",
                "es": "decimales",
                "pl": "miejsca po przecinku",
                "zh-cn": "小数点"
            },
            "temptickSize": {
                "en": "tick size",
                "de": "Tick-Größe",
                "ru": "размер галочки",
                "pt": "tamanho do carrapato",
                "nl": "teken grootte",
                "fr": "taille de la tique",
                "it": "dimensione tick",
                "es": "tamaño de la garrapata",
                "pl": "rozmiar kleszcza",
                "zh-cn": "刻度大小"
            },
            "tempminTickSize": {
                "en": "min. tick size",
                "de": "Mindest. Tick-Größe",
                "ru": "минимум размер галочки",
                "pt": "min. tamanho do carrapato",
                "nl": "min. teken grootte",
                "fr": "min. taille de la tique",
                "it": "min. dimensione tick",
                "es": "min. tamaño de la garrapata",
                "pl": "min. rozmiar kleszcza",
                "zh-cn": "分钟刻度大小"
            },

            "cloudtickLength": {
                "en": "length of tick",
                "de": "Länge des Ticks",
                "ru": "длина тика",
                "pt": "comprimento do carrapato",
                "nl": "lengte van de teek",
                "fr": "longueur de tique",
                "it": "lunghezza del segno di spunta",
                "es": "longitud de la garrapata",
                "pl": "długość kleszcza",
                "zh-cn": "tick的长度"
            },
            "cloudshowMinorTicks": {
                "en": "show minor tick",
                "de": "zeige kleine Ticks",
                "ru": "показать небольшую галочку",
                "pt": "mostre carrapato menor",
                "nl": "toon kleine vinkjes",
                "fr": "montrer une tique mineure",
                "it": "mostra segno di spunta minore",
                "es": "mostrar marca menor",
                "pl": "pokaż drobne kleszcze",
                "zh-cn": "显示小勾"
            },
            "cloudshowTicks": {
                "en": "show tick",
                "de": "zeige ticks",
                "ru": "показать галочку",
                "pt": "show tick",
                "nl": "vinkje tonen",
                "fr": "montrer tique",
                "it": "mostra tick",
                "es": "mostrar marca",
                "pl": "pokaż tik",
                "zh-cn": "显示刻度"
            },
            "cloudtickDecimals": {
                "en": "decimals",
                "de": "Dezimalstellen",
                "ru": "десятичные",
                "pt": "decimais",
                "nl": "decimalen",
                "fr": "décimales",
                "it": "decimali",
                "es": "decimales",
                "pl": "miejsca po przecinku",
                "zh-cn": "小数点"
            },
            "cloudtickSize": {
                "en": "tick size",
                "de": "Tick-Größe",
                "ru": "размер галочки",
                "pt": "tamanho do carrapato",
                "nl": "teken grootte",
                "fr": "taille de la tique",
                "it": "dimensione tick",
                "es": "tamaño de la garrapata",
                "pl": "rozmiar kleszcza",
                "zh-cn": "刻度大小"
            },
            "cloudminTickSize": {
                "en": "min. tick size",
                "de": "Mindest. Tick-Größe",
                "ru": "минимум размер галочки",
                "pt": "min. tamanho do carrapato",
                "nl": "min. teken grootte",
                "fr": "min. taille de la tique",
                "it": "min. dimensione tick",
                "es": "min. tamaño de la garrapata",
                "pl": "min. rozmiar kleszcza",
                "zh-cn": "分钟刻度大小"
            },

            "templabelwidth": {
                "en": "label width",
                "de": "Labelbreite",
                "ru": "ширина этикетки",
                "pt": "largura da etiqueta",
                "nl": "labelbreedte",
                "fr": "largeur d'étiquette",
                "it": "larghezza dell'etichetta",
                "es": "ancho de etiqueta",
                "pl": "szerokość etykiety",
                "zh-cn": "标签宽度"
            },
            "rainlabelwidth": {
                "en": "label width",
                "de": "Labelbreite",
                "ru": "ширина этикетки",
                "pt": "largura da etiqueta",
                "nl": "labelbreedte",
                "fr": "largeur d'étiquette",
                "it": "larghezza dell'etichetta",
                "es": "ancho de etiqueta",
                "pl": "szerokość etykiety",
                "zh-cn": "标签宽度"
            },
            "chancerainlabelwidth": {
                "en": "label width",
                "de": "Labelbreite",
                "ru": "ширина этикетки",
                "pt": "largura da etiqueta",
                "nl": "labelbreedte",
                "fr": "largeur d'étiquette",
                "it": "larghezza dell'etichetta",
                "es": "ancho de etiqueta",
                "pl": "szerokość etykiety",
                "zh-cn": "标签宽度"
            },
            "cloudslabelwidth": {
                "en": "label width",
                "de": "Labelbreite",
                "ru": "ширина этикетки",
                "pt": "largura da etiqueta",
                "nl": "labelbreedte",
                "fr": "largeur d'étiquette",
                "it": "larghezza dell'etichetta",
                "es": "ancho de etiqueta",
                "pl": "szerokość etykiety",
                "zh-cn": "标签宽度"
            },
            "withlegend": {
                "en": "show legend",
                "de": "Legende anzeigen",
                "ru": "показать легенду",
                "pt": "mostrar legenda",
                "nl": "toon legende",
                "fr": "montrer la légende",
                "it": "mostra legenda",
                "es": "Mostrar leyenda",
                "pl": "pokaż legendę",
                "zh-cn": "显示传奇"
            },
            "legendposition": {
                "en": "legend position",
                "de": "Legendenposition",
                "ru": "положение легенды",
                "pt": "posição da legenda",
                "nl": "legende positie",
                "fr": "position de la légende",
                "it": "posizione della legenda",
                "es": "posición de leyenda",
                "pl": "pozycja legendy",
                "zh-cn": "图例位置"
            },
            "WithHOver": {
                "en": "With Value box",
                "de": "Mit Wertbox",
                "ru": "С коробкой ценности",
                "pt": "Com caixa de valor",
                "nl": "Met Value box",
                "fr": "Avec boîte de valeur",
                "it": "Con Valore",
                "es": "Con caja de valor",
                "pl": "Wagon z Value",
                "zh-cn": "价值箱"
            },
            "WithPoints": {
                "en": "with points",
                "de": "mit Punkten",
                "ru": "с точками",
                "pt": "com pontos",
                "nl": "met punten",
                "fr": "avec points",
                "it": "con punti",
                "es": "con puntos",
                "pl": "punkty",
                "zh-cn": "要点"
            }

        });
    }



    vis.binds.weather = {
        version: "2.5.6",
        showVersion: function () {
            if (vis.binds.weather.version) {
                console.log('Version vis-weather: ' + vis.binds.weather.version);
                vis.binds.weather.version = null;
            }
        },
        setup: {
            intervals:
            {
                '1 second': 1000,
                '10 seconds': 10000,
                '30 seconds': 30000,
                '1 minute': 60000,
                '2 minutes': 120000,
                '5 minutes': 300000,
                '10 minutes': 600000,
                '30 minutes': 1800000,
                '1 hour': 3600000,
                '2 hours': 7200000,
                '4 hours': 14400000,
                '8 hours': 28800000,
                '12 hours': 43200000,
                '24 hours': 86400000
            },
        },
        tempandrain: {

            init: function (widgetID, view, data1, style) {
                var $div = $('#' + widgetID);
                console.log("temp and rain init (" + widgetID + ")");
                var data = {};
                for (var s in data1) {
                    if (s[0] !== '_' && data1.hasOwnProperty(s) && typeof data1[s] !== 'object' && typeof data1[s] !== 'function') {
                        data[s] = data1[s];
                    }

                }

                function SetMarkingColor(color) {
                    MarkingColor = color;
                }

                function degreeFormatter(v, axis) {
                    return v.toFixed(axis.tickDecimals) + "°C";
                }

                function percentageFormatter(v, axis) {
                    return v.toFixed(axis.tickDecimals) + "%";
                }

                function mmFormatter(v, axis) {
                    return v.toFixed(axis.tickDecimals) + "mm";
                }

                function legendformater(label, series) {

                    //wenn keine Daten, dann ausblenden ->  (return null)
                    if (series.data == null || typeof series.data == "undefined" || typeof series.data[0] == "undefined") {

                        console.log('legendformater no label because no data ');
                        return null;
                    }
                    else {
                        console.log('legendformater label ' + label);
                        return label;
                    }
                }

                

                function GridMarkings(axes) {

                    var markings = [];
                    var minDate = new Date(axes.xaxis.min);

                    //start from midnight
                    minDate.setHours(0);

                    const dayDiff = (axes.xaxis.max - axes.xaxis.min) / 1000 / 60 / 60 / 24;
                    console.log('GridMarkings: DayDiff ' + dayDiff + ' (' + axes.xaxis.max + ' ' + axes.xaxis.min + ') start at ' + minDate.toString());

                    var i = minDate.getTime();

                    //if we only few hours then we need markings per hour otherwise per day
                    let limit = 0;
                    if (dayDiff > 2) {
                        do {
                            //console.log("new day marking from " + i);
                            markings.push({ xaxis: { from: i, to: i + 24 * 60 * 60 * 1000 }, color: MarkingColor });
                            i += 2 * 24 * 60 * 60 * 1000;
                            limit++;
                        } while (i < axes.xaxis.max || limit > 200);

                    }
                    else {

                        do {
                            //console.log("new hour marking from " + i);
                            markings.push({ xaxis: { from: i, to: i + 60 * 60 * 1000 }, color: MarkingColor });
                            i += 2 * 60 * 60 * 1000;
                            limit++;
                        } while (i < axes.xaxis.max || limit > 200);
                    }
                    return markings;

                }

                function CalcTicks4X(axis) {

                    var ticks = [];

                    var minDate = new Date(axis.min);

                    const dayDiff = (axis.max - axis.min) / 1000 / 60 / 60 / 24;

                    console.log('CalcTicks4X: DayDiff ' + dayDiff + ' (' + axis.max + ' ' + axis.min + ')');

                    let limit = 0;
                    //if we only few hours then we need ticks per hour otherwise per day
                    if (dayDiff > 2) {
                        minDate.setHours(12);
                        minDate.setMinutes(0);
                        var i = minDate.getTime();

                        do {
                            //console.log("new day tick at " + i);
                            ticks.push([i]);
                            i += 24 * 60 * 60 * 1000;
                            limit++;
                        } while (i < axis.max || limit > 200);
                    }
                    else {
                        minDate.setHours(0);
                        minDate.setMinutes(0);
                        var i = minDate.getTime();

                        do {
                            //console.log("new hour tick at " + i);
                            ticks.push([i]);
                            i += 6 * 60 * 60 * 1000;
                            limit++;
                        } while (i < axis.max || limit > 200);
                    }
                    return ticks;
                }

                //should avoid endles loops
                let UpdateRetryCounter = 0;

                function update() {

                    console.log("ShowChart temp/rain/cloud  (" + widgetID + ") retry counter " + UpdateRetryCounter);

                    var $div = $('#' + widgetID);
                    // if nothing found => wait
                    if (!$div.length) {
                        return setTimeout(function () {
                            console.log("need to wait... (" + widgetID + ")");
                            if (UpdateRetryCounter < 5) {
                                UpdateRetryCounter++;
                                update();
                            }
                        }, 1000);
                    }

                    UpdateRetryCounter = 0;
                    console.log("ShowChart temp/rain/cloud begin (" + widgetID + ")");

                    if (!data || !data.instance) {
                        console.log("keine instanz  (" + widgetID + ")");
                        $div.html("<br> <center> <font color='red'> no instance for DasWetter specified </font> </center></br>");
                    }
                    else if (data.instance.indexOf("daswetter") > -1 && data.oid_date == "") {
                        console.log("no OID's for DasWetter  (" + widgetID + ")");
                        $div.html("<br> <center> <font color='red'> no OID's for DasWetter specified </font> </center></br>");
                    }
                    else {

                        SetMarkingColor(data.markingcolor);

                        var values_rain = [];
                        var values_chancerain = [];
                        var maxY_rain = -99;
                        var minY_rain = 100;
                        var values_temp = [];
                        var maxY_temp = -99;
                        var minY_temp = 100;
                        var values_cloud = [];
                        var maxY_cloud = 100;
                        var minY_cloud = 0;
                        var cnt = 0;


                        var max_cnt = 0;
                        var day = 0;
                        var month = 0;
                        var year = 0;
                        var hour = 0;
                        var minute = 0;

                        var dateMin = -1;
                        var dateMax = -1;

                        var nTimeDiff = -1;
                        var oldHour = -1;

                        if (data.instance.indexOf("daswetter") > -1) {

                            //get first date only for DasWetter.com
                            //20180825
                            var oid_first_date = data.oid_date;
                            var sDate = vis.states[oid_first_date + '.val'];
                            var day = parseInt(sDate.substring(6, 8), 10);
                            var month = parseInt(sDate.substring(4, 6), 10);
                            var year = parseInt(sDate.substring(0, 4), 10);
                            //console.log("got " + sDate + " from " + oid_first_date);
                            console.log("got first date " + sDate + " = " + day + "." + month + "." + year);
                            month--;

                            max_cnt = 40;
                            data.chancerainvisible = false; // value not available!!

                        }
                        else if (data.instance.indexOf("weatherunderground") > -1) {
                            max_cnt = 36;
                        }

                        //console.log("date is " + day +"."+month+"."+year);
                        var lastHour = -1;
                        for (var d = 0; d < max_cnt; d++) {

                            //get rain values
                            var oid_rain = data['oid_rain' + d];
                            var val_rain = parseFloat(vis.states[oid_rain + '.val']);
                            //console.log("got " + val_rain + " from " + oid_rain);
                            if (val_rain > maxY_rain) maxY_rain = val_rain;
                            if (val_rain < minY_rain) minY_rain = val_rain;
                            var oid_chancerain = data['oid_chancerain' + d];
                            var val_chancerain = parseInt(vis.states[oid_chancerain + '.val'], 10);
                            //console.log("got " + val_chancerain + " from " + oid_chancerain);


                            //get temperature values
                            var oid_temp = data['oid_temp' + d];
                            var val_temp = parseInt(vis.states[oid_temp + '.val'], 10);
                            //console.log("got " + val_temp + " from " + oid_temp);
                            if (val_temp > maxY_temp) maxY_temp = val_temp;
                            if (val_temp < minY_temp) minY_temp = val_temp;

                            //get cloud values
                            var oid_cloud = data['oid_cloud' + d];
                            var val = parseInt(vis.states[oid_cloud + '.val'], 10);
                            //console.log("got " + val + " from " + oid_cloud);
                            var val_cloud = 0;
                            if (data.sunorcloud == "sun") { //invert value
                                val_cloud = 100 - val;
                            }
                            else {
                                val_cloud = val;
                            }

                            // get time
                            var oid = data['oid_hour' + d];
                            //console.log("check " + oid);
                            if (oid.length < 3) {
                                //stop loop here
                                console.log("less then " + max_cnt + " oid (" + d + ") found");
                                d = max_cnt;
                                break;
                            }
                            var sTime = vis.states[oid + '.val'];
                            //console.log("got " + sTime + " from " + oid);
                            //console.log("got " + sTime );

                            var bDateNotValid = false;
                            var month1 = month + 1;
                            //console.log("### date " + day + "." + month1 + "." + year);

                            var oDate;
                            if (data.instance.indexOf("daswetter") > -1) {

                                hour = parseInt(sTime.substring(0, 2), 10);
                                minute = parseInt(sTime.substring(3, 5), 10);

                                oDate = new Date(year, month, day, hour, minute, 0, 0);

                                //console.log("### check next day " + hour + " ? " + lastHour + " at " + oDate.toLocaleString());

                                //check next day
                                if (hour < lastHour) {
                                    oDate.setDate(oDate.getDate() + 1);
                                    day = oDate.getDate();
                                    month = oDate.getMonth();
                                    year = oDate.getFullYear();

                                    //console.log("### next day found " + oDate.toLocaleString());
                                }
                                lastHour = hour;
                            }
                            else if (data.instance.indexOf("weatherunderground") > -1) {





                                if (typeof sTime == 'undefined') {
                                    bDateNotValid = true;
                                }
                                else {



                                    //check which version??
                                    //V1.x: 05:00 PM CEST am 18. August 2018
                                    //V2.x: 8/18/2018, 5:00:00 PM
                                    //      oder 2018 - 8 - 19 12: 00: 00
                                    var oTemp = sTime.split(' ');
                                    var wuversion = 0;
                                    if (oTemp[1] == "PM" || oTemp[1] == "AM") {
                                        wuversion = 1;
                                        //console.log("+++ old version +++");
                                    }
                                    else {
                                        wuversion = 2;
                                        //console.log("+++ new version +++");
                                    }

                                    if (wuversion == 2) {

                                        //acc. https://stackoverflow.com/questions/4310953/invalid-date-in-safari#
                                        //safari doesnt support 2018-8-26
                                        //it supports:
                                        //MM - dd - yyyy
                                        //yyyy / MM / dd
                                        //MM / dd / yyyy
                                        //MMMM dd, yyyy
                                        //MMM dd, yyyy
                                        //so we just replace '-' by '/'

                                        //test only:
                                        //sTime = "2018-8-26";

                                        //in WU wird ToLocalstring verwendet
                                        var oDateWU = new Date(sTime.replace(/-/g, "/"));
                                        hour = oDateWU.getHours();
                                        minute = oDateWU.getMinutes();
                                        year = oDateWU.getFullYear();
                                        month = oDateWU.getMonth();
                                        day = oDateWU.getDate();
                                        //console.log("--------" + sTime + " = " + oDateWU.toLocaleString());
                                    }
                                    else {
                                        // WU V1.0

                                        //04:00 PM CEST am 14. Mai 2017

                                        var oTemp1 = oTemp[0].split(':');

                                        hour = parseInt(oTemp1[0], 10);
                                        if (oTemp[1] == "PM" && hour != 12) {
                                            hour += 12; //PM
                                        }
                                        if (oTemp[1] == "AM" && hour == 12) {
                                            hour = 0; //AM
                                        }
                                        //12 PM ist 12 Mittags
                                        //12 AM ist 0 Nachts

                                        minute = parseInt(oTemp1[1], 10);
                                        year = parseInt(oTemp[6], 10);

                                        switch (oTemp[5]) {
                                            case "Januar": month = 0; break;
                                            case "Februar": month = 1; break;
                                            case "März": month = 2; break;
                                            case "April": month = 3; break;
                                            case "Mai": month = 4; break;
                                            case "Juni": month = 5; break;
                                            case "Juli": month = 6; break;
                                            case "August": month = 7; break;
                                            case "September": month = 8; break;
                                            case "Oktober": month = 9; break;
                                            case "November": month = 10; break;
                                            case "Dezember": month = 11; break;
                                        }


                                        day = parseInt(oTemp[4], 10);
                                    }
                                    //console.log("--------" + day + "." + month + 1 + "." + year + " " + hour + ":" + minute);
                                    oDate = new Date(year, month, day, hour, minute, 0, 0);
                                }
                            }
                            //console.log("-#--#---" + day + "." + month + "." + year + " " + hour + ":" + minute);

                            if (oldHour > 0) {
                                nTimeDiff = hour - oldHour;
                            }
                            //console.log("++++ timediff " + nTimeDiff);
                            oldHour = hour;

                            //console.log("### " + oDate.toLocaleString() + " = " + oDate.getTime() + " rain: " + val_rain + " temp: " + val_temp + " cloud: " + val_cloud);

                            if (!bDateNotValid) {
                                //need time in UTC
                                var date = oDate.getTime();

                                if (dateMin === -1) {
                                    dateMin = date;
                                }
                                dateMax = date;
                                //console.log(date);
                                values_rain.push([date, val_rain]);
                                values_temp.push([date, val_temp]);
                                values_cloud.push([date, val_cloud]);
                                values_chancerain.push([date, val_chancerain]);
                            }
                        }



                        //maxY += 0.1 * maxY;
                        //minY -= 0.1 * minY;

                        maxY_temp = Math.ceil((maxY_temp + 1) / 10) * 10;
                        if (minY_temp > 0) {
                            minY_temp = 0;
                        }
                        else {
                            var temp1 = Math.abs(minY_temp);

                            minY_temp = Math.ceil((temp1 + 1) / 10) * 10;
                            minY_temp = -1.0 * minY_temp;
                        }

                        console.log("maxY_temp " + data.maxY_temp);
                        if (parseInt(data.maxY_temp, 10) != 0) {
                            maxY_temp = parseInt(data.maxY_temp, 10);
                        }

                        console.log("minY_temp " + data.minY_temp);
                        if (parseInt(data.minY_temp, 10) != 0) {
                            minY_temp = parseInt(data.minY_temp, 10);
                        }


                        maxY_rain = Math.ceil((maxY_rain + 1) / 10) * 10;
                        if (maxY_rain < 10) maxY_rain = 10;

                        console.log("start with maxRain " + maxY_rain + " minRain " + minY_rain + " maxTemp " + maxY_temp + " minTemp " + minY_temp + " " + dateMin + " " + dateMax);


                        var barwidth = 0;
                        if (data.instance.indexOf("daswetter") > -1) {

                            if (nTimeDiff > 0) {
                                barwidth = 1000 * 60 * 60 * nTimeDiff;
                            }
                            else {
                                barwidth = 1000 * 60 * 60 * 1; //1h
                            }
                        }
                        else if (data.instance.indexOf("weatherunderground") > -1) {
                            barwidth = 1000 * 60 * 60 * 0.5; //0.5h
                        }
                        console.log("barwidth = " + barwidth + " with TimeDiff " + nTimeDiff + "ms"); // in ms



                        console.log("start plot (" + widgetID + ") ");



                        $.plot($div,
                            [{
                                data: data.chancerainvisible ? values_chancerain : {},
                                color: data.chanceraincolor,
                                xaxis: 1,
                                yaxis: 4,
                                label: data.chancerainname,
                                lines: { show: false },
                                points: { show: data.WithPoints },
                                bars:
                                {
                                    show: true,
                                    barWidth: [barwidth, true],
                                    align: "left", //"center",
                                    horizontal: false
                                }
                            },

                            {
                                data: data.tempvisible ? values_temp : {},
                                color: data.tempcolor,
                                xaxis: 1,
                                yaxis: 1,
                                label: data.tempname,
                                lines: { show: data.tempchartType == "line" ? true : false, fill: false },
                                points: { show: data.WithPoints },
                                bars:
                                {
                                    show: data.tempchartType == "bar" ? true : false,
                                    barWidth: [barwidth, true],
                                    align: "left", //"center",
                                    horizontal: false
                                }
                            },
                            {
                                data: data.rainvisible ? values_rain : {},
                                color: data.raincolor,
                                xaxis: 1,
                                yaxis: 2,
                                label: data.rainname,
                                lines: { show: data.rainchartType == "line" ? true : false, fill: false },
                                points: { show: data.WithPoints },
                                bars:
                                {
                                    show: data.rainchartType == "bar" ? true : false,
                                    barWidth: [barwidth, true],
                                    align: "left", //"center",
                                    horizontal: false
                                }
                            },
                            {
                                data: data.cloudsvisible ? values_cloud : {},
                                color: data.cloudcolor,
                                xaxis: 1,
                                yaxis: 3,
                                label: data.cloudsname,
                                lines: { show: data.cloudschartType == "line" ? true : false, fill: false },
                                points: { show: data.WithPoints },
                                bars:
                                {
                                    show: data.cloudschartType == "bar" ? true : false,
                                    barWidth: [barwidth, true],
                                    align: "left", //"center",
                                    horizontal: false
                                }
                            }

                            ],
                            {

                                xaxes:
                                    [{
                                        axisLabelUseCanvas: true,
                                        axisLabelColour: 'orange',

                                        show: data.withxaxix,
                                        mode: "time",
                                        timeBase: "milliseconds",
                                        tickLength: 5,

                                        min: dateMin,
                                        max: dateMax,
                                        //ticks: data.ticksonxaxix > 0 ? parseInt(data.ticksonxaxix, 10) : 5,
                                        ticks: CalcTicks4X,
                                        autoScale: "none",
                                        timeformat: data.xDateFormat,
                                        monthNames: ["Jan", "Feb", "Mar", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez"],
                                        color: data.tickscolor,
                                        tickColor: data.tickscolor,
                                        font: {
                                            size: data.LabelFontSize,
                                            lineHeight: 13,
                                            style: "normal", //"italic",
                                            weight: "bold",
                                            family: data.LabelFontFamily,
                                            variant: "small-caps",
                                            color: data.axislabelcolor,


                                        },
                                        timezone: "browser"
                                    }],

                                yaxes:

                                    //temp y-axis #1
                                    [{
                                        axisLabelUseCanvas: true,
                                        axisLabelColour: 'orange',


                                        show: (data.tempvisible && data.yTempVisible),
                                        //max: parseInt(data.maxY_temp,10) != 0 ? parseInt(data.maxY_temp, 10) : maxY_temp, //0 = default = auto determine max/min value
                                        //min: parseInt(data.minY_temp,10) != 0 ? parseInt(data.minY_temp, 10) : minY_temp,
                                        max: maxY_temp,
                                        min: minY_temp,
                                        autoScale: "none", // Available modes: "none", "loose", "exact"
                                        showTickLabels: "major",
                                        alignTicksWithAxis: 1,
                                        position: 'left',
                                        //ticks: 3,

                                        tickLength: parseFloat(data.temptickLength),            //20, // size in pixels of major tick marks
                                        showMinorTicks: data.tempshowMinorTicks,    //false, // true = show minor tick marks, false = hide minor tick marks
                                        showTicks: data.tempshowTicks,              //true, // true = show tick marks, false = hide all tick marks
                                        tickDecimals: data.temptickDecimals,        //1, // no. of decimals, null means auto
                                        tickSize: data.temptickSize,                //3, // number or [number, "unit"]
                                        minTickSize: data.tempminTickSize,          //1, // number or [number, "unit"]


                                        color: data.tempcoloraxis,
                                        tickColor: data.tempcoloraxis,

                                        labelWidth: parseFloat(data.templabelwidth),
                                        //offset: {
                                        //    below: 0,
                                        //    above: 0
                                        //},

                                        //boxPosition: {                          ////position of the axis on the corresponding axis box
                                        //    centerX: 0,
                                        //    centerY: 0
                                        //},

                                        font: {
                                            size: data.LabelFontSize,
                                            lineHeight: 13,
                                            style: "normal", //"italic",
                                            weight: "bold",
                                            family: data.LabelFontFamily,
                                            variant: "small-caps",
                                            color: data.tempcolorticklabel,
                                        },
                                        tickFormatter: degreeFormatter
                                    },

                                    //rain visible y-axis #2
                                    {
                                        axisLabelUseCanvas: true,
                                        axisLabelColour: 'orange',

                                        show: (data.rainvisible && data.yRainVisible),
                                        max: maxY_rain,
                                        min: 0,
                                        autoScale: "none", // Available modes: "none", "loose", "exact"
                                        showTickLabels: "major",
                                        alignTicksWithAxis: 2,
                                        position: 'right',
                                        //ticks: 3,

                                        tickLength: parseFloat(data.raintickLength),            //20, // size in pixels of major tick marks
                                        showMinorTicks: data.rainshowMinorTicks,    //false, // true = show minor tick marks, false = hide minor tick marks
                                        showTicks: data.rainshowTicks,              //true, // true = show tick marks, false = hide all tick marks
                                        tickDecimals: data.raintickDecimals,        //1, // no. of decimals, null means auto
                                        tickSize: data.raintickSize,                //3, // number or [number, "unit"]
                                        minTickSize: data.rainminTickSize,          //1, // number or [number, "unit"]


                                        color: data.raincoloraxis,
                                        tickColor: data.raincoloraxis,

                                        labelWidth: parseFloat(data.rainlabelwidth),
                                        //offset: {
                                        //    below: 0,
                                        //    above: 0
                                        //},

                                        //boxPosition: {                          ////position of the axis on the corresponding axis box
                                        //    centerX: 0,
                                        //    centerY: 0
                                        //},

                                        font: {
                                            size: data.LabelFontSize,
                                            lineHeight: 13,
                                            style: "normal", //"italic",
                                            weight: "bold",
                                            family: data.LabelFontFamily,
                                            variant: "small-caps",
                                            color: data.raincolorticklabel,
                                        },
                                        tickFormatter: mmFormatter
                                    },

                                    //sun-cloud y-axis
                                    {
                                        axisLabelUseCanvas: true,
                                        axisLabelColour: 'orange',

                                        show: (data.cloudsvisible && data.yCloudVisible),
                                        max: maxY_cloud,
                                        min: minY_cloud,
                                        autoScale: "none", // Available modes: "none", "loose", "exact"
                                        showTickLabels: "major",
                                        alignTicksWithAxis: 3,
                                        position: 'left',
                                        //ticks: 3,

                                        tickLength: parseFloat(data.cloudtickLength),            //20, // size in pixels of major tick marks
                                        showMinorTicks: data.cloudshowMinorTicks,    //false, // true = show minor tick marks, false = hide minor tick marks
                                        showTicks: data.cloudshowTicks,              //true, // true = show tick marks, false = hide all tick marks
                                        tickDecimals: data.cloudtickDecimals,        //1, // no. of decimals, null means auto
                                        tickSize: data.cloudtickSize,                //3, // number or [number, "unit"]
                                        minTickSize: data.cloudminTickSize,          //1, // number or [number, "unit"]

                                        color: data.cloudcoloraxis,
                                        tickColor: data.cloudcoloraxis,

                                        labelWidth: parseFloat(data.cloudslabelwidth),
                                        //offset: {
                                        //    below: 0,
                                        //    above: 0
                                        //},

                                        //boxPosition: {                          ////position of the axis on the corresponding axis box
                                        //    centerX: 0,
                                        //    centerY: 0
                                        //},

                                        font: {
                                            size: data.LabelFontSize,
                                            lineHeight: 13,
                                            style: "normal", //"italic",
                                            weight: "bold",
                                            family: data.LabelFontFamily,
                                            variant: "small-caps",
                                            color: data.cloudcolorticklabel
                                        },
                                        tickFormatter: percentageFormatter
                                    },

                                    //chance rain y-axis  #4
                                    {
                                        axisLabelUseCanvas: true,
                                        axisLabelColour: 'orange',

                                        show: (data.chancerainvisible && data.yChanceRainVisible),  //much better visible without
                                        max: 100,
                                        min: 0,
                                        autoScale: "none", // Available modes: "none", "loose", "exact"
                                        showTickLabels: "major",
                                        alignTicksWithAxis: 4,
                                        position: 'right',
                                        //ticks: 3,

                                        tickLength: parseFloat(data.chanceraintickLength),            //20, // size in pixels of major tick marks
                                        showMinorTicks: data.chancerainshowMinorTicks,    //false, // true = show minor tick marks, false = hide minor tick marks
                                        showTicks: data.chancerainshowTicks,              //true, // true = show tick marks, false = hide all tick marks
                                        tickDecimals: data.chanceraintickDecimals,        //1, // no. of decimals, null means auto
                                        tickSize: data.chanceraintickSize,                //3, // number or [number, "unit"]
                                        minTickSize: data.chancerainminTickSize,          //1, // number or [number, "unit"]


                                        color: data.chanceraincoloraxis,
                                        tickColor: data.chanceraincoloraxis,

                                        labelWidth: parseFloat(data.chancerainlabelwidth),
                                        //offset: {
                                        //    below: 0,
                                        //    above: 0
                                        //},

                                        //boxPosition: {                          ////position of the axis on the corresponding axis box
                                        //    centerX: 0,
                                        //    centerY: 0
                                        //},

                                        font: {
                                            size: data.LabelFontSize,
                                            lineHeight: 13,
                                            style: "normal", //"italic",
                                            weight: "bold",
                                            family: data.LabelFontFamily,
                                            variant: "small-caps",

                                            color: data.chanceraincolorticklabel
                                        },
                                        tickFormatter: percentageFormatter
                                    }],
                                grid:
                                {
                                    //hover
                                    hoverable: true, //to trigger plothover event on mouse hover or tap on a point
                                    clickable: true, //to trigger plotclick event on mouse hover

                                    markings: data.withmarking ? GridMarkings : null,

                                    // backgroundColor: data.nobgcolor ? null : { colors: ["#fff", "#eee"] },
                                    backgroundColor: data.nobgcolor ? null : data.bgcolor,
                                    borderWidth: parseFloat(data.borderWidth), //data.withborder,
                                    borderColor: data.bordercolor,
                                    margin: 1,
                                    /*
                                    borderWidth: {
                                        top: data.withborder ? 1 : 0,
                                        right: data.withborder ? 1 : 0,
                                        bottom: data.withborder ? 2 : 0,
                                        left: data.withborder ? 2 : 0
                                    },*/

                                },
                                legend: {
                                    show: data.withlegend,
                                    labelFormatter: legendformater,
                                    //labelBoxBorderColor: color,
                                    //noColumns: number,
                                    position: data.legendposition,
                                    //margin: number of pixels or [x margin, y margin]
                                    backgroundColor: null,
                                    backgroundOpacity: 0,
                                    container: null,
                                    sorted: false
                                },
                            }
                        );

                        //****************************************************************************************
                        //hover

                        console.log("hover start " + widgetID + " " + data.WithHOver);
                        if (data.WithHOver) {
                            console.log("hover start " + widgetID);
                            $('#' + widgetID).bind("plotclick", function (event, pos, item) {
                                console.log("clicked at " + pos.x + ", " + pos.y);
                                // axis coordinates for other axes, if present, are in pos.x2, pos.x3, ...
                                // if you need global screen coordinates, they are pos.pageX, pos.pageY

                                if (item) {

                                    let x = item.datapoint[0];
                                    let y = item.datapoint[1].toFixed(2);

                                    var xDate = new Date(x);

                                    console.log("clicked a point!" + item.series.label + " " + y + " on " + xDate.toLocaleString());

                                    $("#tooltip").html("Wert " + y)
                                        .css({ top: item.pageY + 5, left: item.pageX + 5 })
                                        .fadeIn(200);

                                }
                                else {
                                    $("#tooltip").stop().hide();
                                }
                            });

                            $("<div id='tooltip'></div>").css({
                                position: "absolute",
                                display: "none",
                                border: "1px solid #fdd",
                                padding: "2px",
                                "background-color": "#fee",
                                opacity: 0.80
                            }).appendTo("body");
                            //****************************************************************************************

                        }
                    }
                };

                

                if (data.instance) {
                    //Umschalten wu / daswetter und auf oid zugreifen
                    var max_cnt = 0;
                    if (data.instance.indexOf("daswetter") > -1) {
                        var oid_first_date = data.oid_date;
                        //console.log("bind " + oid_first_date);
                        vis.states.bind(oid_first_date + '.val', function () {
                            update();
                        });
                        max_cnt = 40;
                    }

                    else if (data.instance.indexOf("weatherunderground") > -1) {
                        max_cnt = 36;
                    }

                    else {
                        console.log("no wether instance set in init " + data.instance);
                    }

                    if (data.instance.indexOf("weatherunderground") > -1) {
                        for (var i = 0; i < max_cnt; i++) {
                            //get chance rain oid
                            var oid_chancerain = data['oid_chancerain' + i];
                            //console.log("bind " + oid_chancerain);
                            vis.states.bind(oid_chancerain + '.val', function () {
                                update();
                            });
                        }

                    }

                    //gilt für beide nur mit unterschiedlichen grenzen
                    for (var i = 0; i < max_cnt; i++) {
                        //get rain oid
                        var oid_rain = data['oid_rain' + i];
                        //console.log("bind " + oid_rain);
                        vis.states.bind(oid_rain + '.val', function () {
                            update();
                        });
                        //get temperature oid
                        var oid_temp = data['oid_temp' + i];
                        //console.log("bind " + oid_temp);
                        vis.states.bind(oid_temp + '.val', function () {
                            update();
                        });
                        //get cloud oid
                        var oid_cloud = data['oid_cloud' + i];
                        //console.log("bind " + oid_cloud);
                        vis.states.bind(oid_cloud + '.val', function () {
                            update();
                        });
                        // get time oid
                        var oid_hour = data['oid_hour' + i];
                        //console.log("bind " + oid_hour);
                        vis.states.bind(oid_hour + '.val', function () {
                            update();
                        });
                    }

                    // update every x seconds
                    if (!vis.editMode) {
                        console.log("interval " + vis.binds.weather.setup.intervals[data.time_interval]);
                        $div.data('timer', setInterval(function () {
                            update();
                        }, parseInt(vis.binds.weather.setup.intervals[data.time_interval] / (parseInt(data.points, 10) || 10), 10)));
                    }
                }
                else {
                    console.log("instance not set ");
                }
                update();
                if (vis.editMode) {
                    console.log("flot version " + $.plot.version + " for weather");
                }
            }
        },
    };

    if (vis.editMode) {
        vis.binds.weather.onInstanceChanged = function (widgetID, view, newId, fields) {
            //we use the same callback for different changes;
            //so we need to check what have been changed...
            console.log('--------- : ' + widgetID + ' - ' + view + ' - ' + newId + ' - ' + fields);
            var instanceID = "";
            var datastructurename = "";
            if (fields == "instance") {
                instanceID = newId;
                datastructurename = vis.widgets[widgetID].data.datastructure;
                console.log('instance changed to ' + newId + ' old structure = ' + datastructurename);
            }

            else if (fields == "datastructure") {
                datastructurename = newId;
                instanceID = vis.widgets[widgetID].data.instance;
                console.log('datastructure changed to ' + newId + ' old instance = ' + instanceID);
            }



            //delete all
            vis.views[view].widgets[widgetID].data.oid_date = "";
            vis.widgets[widgetID].data.oid_date = "";

            for (var h = 0; h < 40; h++) {
                vis.views[view].widgets[widgetID].data['oid_rain' + h] = "";
                vis.widgets[widgetID].data['oid_rain' + h] = "";
                vis.views[view].widgets[widgetID].data['oid_chancerain' + h] = "";
                vis.widgets[widgetID].data['oid_chancerain' + h] = "";
                vis.views[view].widgets[widgetID].data['oid_temp' + h] = "";
                vis.widgets[widgetID].data['oid_temp' + h] = "";
                vis.views[view].widgets[widgetID].data['oid_cloud' + h] = "";
                vis.widgets[widgetID].data['oid_cloud' + h] = "";
                vis.views[view].widgets[widgetID].data['oid_hour' + h] = "";
                vis.widgets[widgetID].data['oid_hour' + h] = "";
            }

            //wu oder DasWetter (umschaltbar)

            var changed = [];
            var oid_rain = "";
            var oid_chancerain = "";
            var oid_temp = "";
            var oid_cloud = "";
            var oid_hour = "";

            if (instanceID.indexOf("daswetter") > -1) {
                var daswetterversion = 0;
                //with 1.x: daswetter.0.NextDaysDetailed.0d.date 20180524
                //with 2.x: daswetter.0.NextDaysDetailed.Location_1.Day_1.day_value 20180524
                var oid_first_date = "";
                if (vis.views[view].widgets[widgetID].data.datastructure == "NextDaysDetailed") {
                    oid_first_date = instanceID + ".NextDaysDetailed.Location_1.Day_1.day_value";
                }

                else if (vis.views[view].widgets[widgetID].data.datastructure == "NextHours") {
                    oid_first_date = instanceID + ".NextHours.Location_1.Day_1.day_value";
                }

                else if (vis.views[view].widgets[widgetID].data.datastructure == "NextHours2") {
                    oid_first_date = instanceID + ".NextHours2.Location_1.Day_1.date";
                }


                if (vis.objects[oid_first_date]) {
                    daswetterversion = 2;
                    console.log("using new data structure with DasWetter");
                }

                else {
                    oid_first_date = instanceID + ".NextDaysDetailed.0d.date";
                    if (vis.objects[oid_first_date]) {
                        daswetterversion = 1;
                        console.log("using old data structure with DasWetter");
                    }

                }

                //which datastructure
                console.log("datastructure is " + vis.views[view].widgets[widgetID].data.datastructure);


                if (vis.objects[oid_first_date]) {
                    //console.log(oid_first_date + " updated ");
                    vis.views[view].widgets[widgetID].data.oid_date = oid_first_date;
                    vis.widgets[widgetID].data.oid_date = oid_first_date;
                }

                var cnt = 0;
                var max_days = 5;
                var max_periods = 8;


                //we only have 40 OID'S!!!
                if (daswetterversion == 2) {
                    if (vis.views[view].widgets[widgetID].data.datastructure == "NextDaysDetailed") {
                        max_days = 5;
                        max_periods = 8;
                    }

                    else if (vis.views[view].widgets[widgetID].data.datastructure == "NextHours") {
                        max_days = 5;
                        max_periods = 24;
                    }

                    else if (vis.views[view].widgets[widgetID].data.datastructure == "NextHours2") {
                        max_days = 5;
                        max_periods = 8;
                    }

                }


                for (var d = 0; d < max_days; d++) {
                    for (var p = 0; p < max_periods; p++) {
                        //get rain oid

                        if (daswetterversion == 1) {
                            oid_rain = instanceID + ".NextDaysDetailed." + d + "d." + p + "h.Rain";
                            //get temperature oid
                            oid_temp = instanceID + ".NextDaysDetailed." + d + "d." + p + "h.Temperature";
                            //get cloud oid
                            oid_cloud = instanceID + ".NextDaysDetailed." + d + "d." + p + "h.Clouds";
                            // get time oid
                            oid_hour = instanceID + ".NextDaysDetailed." + d + "d." + p + "h.hour";
                        }
                        else if (daswetterversion == 2) {
                            //daswetter.0.NextDaysDetailed.Location_1.Day_1.Hour_1.rain.value
                            var dd = d + 1;
                            var pp = p + 1;
                            //NextDaysDetailed,NextHours,NextHours2
                            if (datastructurename == "NextDaysDetailed") {
                                //daswetter.0.NextDaysDetailed.Location_1.Day_1.Hour_1.rain_value
                                oid_rain = instanceID + ".NextDaysDetailed.Location_1.Day_" + dd + ".Hour_" + pp + ".rain_value";
                                //get temperature oid
                                oid_temp = instanceID + ".NextDaysDetailed.Location_1.Day_" + dd + ".Hour_" + pp + ".temp_value";
                                //get cloud oid
                                oid_cloud = instanceID + ".NextDaysDetailed.Location_1.Day_" + dd + ".Hour_" + pp + ".clouds_value";
                                // get time oid
                                oid_hour = instanceID + ".NextDaysDetailed.Location_1.Day_" + dd + ".Hour_" + pp + ".hour_value";
                            }

                            else if (datastructurename == "NextHours") {
                                //daswetter.0.NextHours.Location_1.Day_1.Hour_1.rain_value
                                oid_rain = instanceID + ".NextHours.Location_1.Day_" + dd + ".Hour_" + pp + ".rain_value";
                                //get temperature oid //daswetter.0.NextHours.Location_1.Day_1.Hour_1.temp_value
                                oid_temp = instanceID + ".NextHours.Location_1.Day_" + dd + ".Hour_" + pp + ".temp_value";
                                //get cloud oid //daswetter.0.NextHours.Location_1.Day_1.Hour_1.clouds_value
                                oid_cloud = instanceID + ".NextHours.Location_1.Day_" + dd + ".Hour_" + pp + ".clouds_value";
                                // get time oid //daswetter.0.NextHours.Location_1.Day_1.Hour_1.hour_value
                                oid_hour = instanceID + ".NextHours.Location_1.Day_" + dd + ".Hour_" + pp + ".hour_value";
                            }

                            else if (datastructurename == "NextHours2") {
                                //daswetter.0.NextHours2.Location_1.Day_1.Hour_1.rain
                                oid_rain = instanceID + ".NextHours2.Location_1.Day_" + dd + ".Hour_" + pp + ".rain";
                                //get temperature oid //daswetter.0.NextHours2.Location_1.Day_1.Hour_1.temp
                                oid_temp = instanceID + ".NextHours2.Location_1.Day_" + dd + ".Hour_" + pp + ".temp";
                                //get cloud oid //daswetter.0.NextHours2.Location_1.Day_1.Hour_1.clouds
                                oid_cloud = instanceID + ".NextHours2.Location_1.Day_" + dd + ".Hour_" + pp + ".clouds";
                                // get time oid //daswetter.0.NextHours2.Location_1.Day_1.Hour_1.hour
                                oid_hour = instanceID + ".NextHours2.Location_1.Day_" + dd + ".Hour_" + pp + ".hour";
                            }

                        }

                        else {
                            console.log("could not define which version to use with DasWetter");
                        }

                        if (vis.objects[oid_rain]) {
                            //console.log(oid_rain + " updated ");
                            vis.views[view].widgets[widgetID].data['oid_rain' + cnt] = oid_rain;
                            vis.widgets[widgetID].data['oid_rain' + cnt] = oid_rain;
                        }

                        if (vis.objects[oid_temp]) {
                            //console.log(oid_temp + " updated ");
                            vis.views[view].widgets[widgetID].data['oid_temp' + cnt] = oid_temp;
                            vis.widgets[widgetID].data['oid_temp' + cnt] = oid_temp;
                        }

                        if (vis.objects[oid_cloud]) {
                            //console.log(oid_cloud + " updated ");
                            vis.views[view].widgets[widgetID].data['oid_cloud' + cnt] = oid_cloud;
                            vis.widgets[widgetID].data['oid_cloud' + cnt] = oid_cloud;
                        }

                        if (vis.objects[oid_hour]) {
                            //console.log(oid_hour + " updated ");
                            vis.views[view].widgets[widgetID].data['oid_hour' + cnt] = oid_hour;
                            vis.widgets[widgetID].data['oid_hour' + cnt] = oid_hour;
                        }

                        cnt++;
                        if (cnt >= 40) {
                            console.log("OID limit reached");
                            break;
                        }

                    }
                }
            }

            else if (instanceID.indexOf("weatherunderground") > -1) {
                vis.views[view].widgets[widgetID].data.datastructure = "";
                vis.widgets[widgetID].data.datastructure = "";
                var wuversion = 0;
                //weatherunderground.0.forecastHourly.0h.time
                var oid_version_check = instanceID + ".forecastHourly.0h.time";
                if (vis.objects[oid_version_check]) {
                    wuversion = 2;
                    console.log("using new data structure with WU");
                }

                else {
                    //weatherunderground.0.forecast.0h.time
                    oid_version_check = instanceID + ".forecast.0h.time";
                    if (vis.objects[oid_version_check]) {
                        wuversion = 1;
                        console.log("using old data structure with WU");
                    }

                }



                for (var h = 0; h < 36; h++) {
                    if (wuversion == 1) {
                        //get rain oid weatherunderground.0.forecast.0h.qpf
                        oid_rain = instanceID + ".forecast." + h + "h.qpf";
                        //get rain oid weatherunderground.0.forecast.0h.qpf
                        oid_chancerain = instanceID + ".forecast." + h + "h.pop";
                        //get temperature oid weatherunderground.0.forecast.0h.temp
                        oid_temp = instanceID + ".forecast." + h + "h.temp";
                        //get cloud oid weatherunderground.0.forecast.0h.sky
                        oid_cloud = instanceID + ".forecast." + h + "h.sky";
                        // get time oid
                        oid_hour = instanceID + ".forecast." + h + "h.time";
                    }

                    else if (wuversion == 2) {
                        //get rain oid weatherunderground.0.forecastHourly.0h.precipitation
                        oid_rain = instanceID + ".forecastHourly." + h + "h.precipitation";
                        //get rain oid weatherunderground.0.forecastHourly.0h.precipitationChance
                        oid_chancerain = instanceID + ".forecastHourly." + h + "h.precipitationChance";
                        //get temperature oid weatherunderground.0.forecastHourly.0h.temp
                        oid_temp = instanceID + ".forecastHourly." + h + "h.temp";
                        //get cloud oid weatherunderground.0.forecastHourly.0h.sky
                        oid_cloud = instanceID + ".forecastHourly." + h + "h.sky";
                        // get time oid weatherunderground.0.forecastHourly.0h.time
                        oid_hour = instanceID + ".forecastHourly." + h + "h.time";
                    }

                    else {
                        console.log("could not define which version to use with WU");
                    }

                    if (vis.objects[oid_rain]) {
                        //console.log(oid_rain + " updated ");
                        vis.views[view].widgets[widgetID].data['oid_rain' + h] = oid_rain;
                        vis.widgets[widgetID].data['oid_rain' + h] = oid_rain;
                    }

                    else {
                        //console.log("wrong version of weatherunderground? >1.0.5?");
                    }

                    if (vis.objects[oid_chancerain]) {
                        //console.log(oid_chancerain + " updated ");
                        vis.views[view].widgets[widgetID].data['oid_chancerain' + h] = oid_chancerain;
                        vis.widgets[widgetID].data['oid_chancerain' + h] = oid_rain;
                    }

                    if (vis.objects[oid_temp]) {
                        //console.log(oid_temp + " updated ");
                        vis.views[view].widgets[widgetID].data['oid_temp' + h] = oid_temp;
                        vis.widgets[widgetID].data['oid_temp' + h] = oid_temp;
                    }

                    if (vis.objects[oid_cloud]) {
                        //console.log(oid_cloud + " updated ");
                        vis.views[view].widgets[widgetID].data['oid_cloud' + h] = oid_cloud;
                        vis.widgets[widgetID].data['oid_cloud' + h] = oid_cloud;
                    }

                    if (vis.objects[oid_hour]) {
                        //console.log(oid_hour + " updated ");
                        vis.views[view].widgets[widgetID].data['oid_hour' + h] = oid_hour;
                        vis.widgets[widgetID].data['oid_hour' + h] = oid_hour;
                    }

                }
            }

            else {
                //ja was nun? do nothing
                console.log(" no weather instance set ");
            }

            return changed;
        }
    }

    vis.binds.weather.showVersion();

</script>



<script id="tplWeatherShowInstance"
        type="text/ejs"
        class="vis-tpl"
        data-vis-set="weather"
        data-vis-name="Weather"
        data-vis-beta="false"
        data-vis-type="weather"
        data-vis-update-style="true"
        data-vis-prev='<img src="widgets/weather/img/Prev_tplWeather.png"></img>'
        data-vis-attrs="instance/weather/onInstanceChanged;"
        data-vis-attrs0="time_interval[30 minutes]/select,1 second,10 seconds,30 seconds,1 minute,2 minutes,5 minutes,10 minutes,30 minutes,1 hour,2 hours,4 hours,8 hours,12 hours,24 hours;"
        data-vis-attrs1="datastructure[NextDaysDetailed]/select,NextDaysDetailed,NextHours,NextHours2/onInstanceChanged;WithHOver[true]/checkbox;WithPoints[true]/checkbox;"
        data-vis-attrs2="withxaxix[true]/checkbox;axislabelcolor[#39e00b]/color;tickscolor[#ffffff]/color;LabelFontSize[8];LabelFontFamily[Arial]/fontname;withmarking[true]/checkbox;markingcolor[#eaebe5]/color;xDateFormat[%d.%b %H:%M];borderWidth[1];bordercolor[#000000]/color;nobgcolor[true]/checkbox;bgcolor[#FFFFFF]/color;withlegend[false]/checkbox;legendposition[ne]/select,ne,nw,se,sw;"
        data-vis-attrs3="group.rain;rainvisible[true]/checkbox;rainchartType[bar]/select,line,bar;rainname[rain];raincolor[#1d0ed8]/color;raincoloraxis[#1d0ed8]/color;raincolorticklabel[#1d0ed8]/color;yRainVisible[true]/checkbox;raintickLength[5];rainshowMinorTicks[true]/checkbox;rainshowTicks[true]/checkbox;raintickDecimals[1];raintickSize[3];rainminTickSize[2];rainlabelwidth[30];"
        data-vis-attrs4="group.chancerain;chancerainvisible[true]/checkbox;chancerainname[chance rain];chanceraincolor[#877efc]/color;chanceraincoloraxis[#1d0ed8]/color;chanceraincolorticklabel[#1d0ed8]/color;yChanceRainVisible[true]/checkbox;chanceraintickLength[5];chancerainshowMinorTicks[true]/checkbox;chancerainshowTicks[true]/checkbox;chanceraintickDecimals[1];chanceraintickSize[3];chancerainminTickSize[2];chancerainlabelwidth[30];"
        data-vis-attrs5="group.temperature;tempvisible[true]/checkbox;tempchartType[line]/select,line,bar;tempname[temperature];tempcolor[#00b3ac]/color;tempcoloraxis[#1d0ed8]/color;tempcolorticklabel[#1d0ed8]/color;maxY_temp[0];minY_temp[0];yTempVisible[true]/checkbox;temptickLength[5];tempshowMinorTicks[true]/checkbox;tempshowTicks[true]/checkbox;temptickDecimals[1];temptickSize[3];tempminTickSize[2];templabelwidth[30];"
        data-vis-attrs6="group.clouds;cloudsvisible/checkbox;cloudschartType[bar]/select,line,bar;cloudsname[clouds]; sunorcloud[sun]/select,sun,clouds;cloudcolor[#f6ef3c]/color;cloudcoloraxis[#1d0ed8]/color;cloudcolorticklabel[#1d0ed8]/color;yCloudVisible[true]/checkbox;cloudtickLength[5];cloudshowMinorTicks[true]/checkbox;cloudshowTicks[true]/checkbox;cloudtickDecimals[1];cloudtickSize[3];cloudminTickSize[2];cloudslabelwidth[30];"
        data-vis-attrs7="group.oids;oid_rain(0-39)/id;oid_chancerain(0-39)/id;oid_temp(0-39)/id;oid_cloud(0-39)/id;oid_hour(0-39)/id;"
        data-vis-attrs8="oid_date/id;">


    <div class="vis-widget <%== this.data.attr('class') %>" style="overflow: hidden; width: 210px; height: 170px; " id="<%= this.data.attr('wid') %>">
        <div class="vis-weather-widget-body">
            <% vis.binds.weather.tempandrain.init(this.data.wid, this.view, this.data, this.style); %>
        </div>

    </div>

</script>


